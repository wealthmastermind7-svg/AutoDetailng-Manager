Multi-Tenancy Booking Platform - Full System Prompt
Overview
A SaaS booking platform where multiple businesses (tenants) can sign up, customize their booking experience, and accept customer bookings directly through a public booking portal.

Architecture
Multi-Tenancy Model
Tenant isolation: Each business is a separate tenant with isolated data
Shared infrastructure: All tenants share the same database/server with row-level security
Subdomain or slug-based access: bookings.app.com/business-slug or business-slug.bookings.app.com
Tech Stack
Frontend:

React Native with Expo (mobile) + React/Next.js (web portal)
TypeScript
React Navigation v7 (mobile)
TanStack React Query
react-native-reanimated for animations
Zustand for state management
Backend:

Express.js with TypeScript
PostgreSQL with Drizzle ORM
JWT authentication with refresh tokens
Row-level security (RLS) for tenant isolation
Infrastructure:

Replit PostgreSQL database
Session management with secure cookies
File uploads (photos/invoices)
Database Schema
// Multi-tenancy foundation
- businesses (id, slug, name, email, phone, logo, timezone, created_at, subscription_tier)
- users (id, business_id, email, password_hash, role, status)
- api_keys (id, business_id, key, secret, created_at)
// Booking system
- services (id, business_id, name, duration, price, description)
- service_addons (id, service_id, name, price)
- time_slots (id, business_id, date, start_time, end_time, is_available)
- bookings (id, business_id, customer_id, service_id, time_slot_id, status, total_price)
// Customer management
- customers (id, business_id, email, phone, name, notes)
- customer_bookings (id, customer_id, booking_id, rating, review)
// Admin/settings
- business_settings (id, business_id, booking_buffer, cancellation_policy, notification_preferences)
- invoices (id, business_id, booking_id, amount, status)
Key Flows
1. Business Owner (Admin Portal)
Signup & Onboarding

Create account → verify email
Enter business details (name, services, pricing)
Set availability (hours, days off, break times)
Customize booking form (required fields, questions)
Dashboard

Calendar view of all bookings
Revenue metrics & analytics
Customer list with booking history
Notifications for new bookings
Settings

Service management (CRUD with pricing/duration)
Team management (invite staff, assign services)
Booking rules (buffer time, cancellation, auto-confirmation)
Payment setup (Stripe/PayPal)
Email/SMS templates
2. Customer (Booking Portal)
Booking Flow

Visit bookings.app.com/acme-detailing
Browse services & availability
Select service → date/time → confirm
Enter contact info → pay (if required)
Receive confirmation email with booking details
Customer Portal

View/manage their bookings
Reschedule or cancel
Rate and review completed services
Payment history
3. Admin Access Control
Business owner can manage team members
Role-based access (admin, staff, viewer)
Staff can only view/manage assigned services
API Structure
Authentication
POST /auth/register          # Business signup
POST /auth/login             # Business login
POST /auth/refresh           # Refresh JWT token
GET  /auth/me               # Current user
POST /auth/logout           # Logout
Businesses (Admin only)
GET    /api/business        # Get current business
PATCH  /api/business        # Update business details
GET    /api/business/analytics  # Revenue, bookings, etc
Services
GET    /api/services        # List all services
POST   /api/services        # Create service
PATCH  /api/services/:id    # Update service
DELETE /api/services/:id    # Delete service
Availability/Time Slots
POST   /api/availability    # Bulk set availability
GET    /api/availability    # Get available slots (public)
DELETE /api/availability/:id
Bookings (Admin view)
GET    /api/bookings        # List bookings
GET    /api/bookings/:id    # Booking details
PATCH  /api/bookings/:id    # Update status
DELETE /api/bookings/:id    # Cancel booking
Public Booking (No auth required)
POST   /api/public/:business_slug/book  # Submit booking
GET    /api/public/:business_slug/services
GET    /api/public/:business_slug/availability
Customers
GET    /api/customers       # List all customers
GET    /api/customers/:id   # Customer details & booking history
PATCH  /api/customers/:id   # Update customer info
Invoices/Payments
GET    /api/invoices        # List invoices
POST   /api/invoices        # Create invoice
GET    /api/payments/stripe-webhook
Frontend Structure
Admin Dashboard (React or Next.js)
/admin
├── auth/
│   ├── login
│   └── signup
├── dashboard/
│   ├── calendar (week/month view)
│   ├── bookings (list with filters)
│   └── analytics
├── services/
│   ├── list
│   └── editor
├── customers/
│   ├── list
│   └── detail
├── settings/
│   ├── business
│   ├── team
│   ├── booking-rules
│   └── payment
└── invoices/
    ├── list
    └── detail
Public Booking Portal
/book/:business_slug
├── services (carousel/grid)
├── availability (calendar)
├── checkout (contact + payment)
└── confirmation
Mobile App (React Native)
Business owner can view bookings on mobile
Push notifications for new bookings
Quick actions (confirm, reschedule, complete)
Authentication & Security
JWT Flow

Login → get access + refresh token
Store refresh token in httpOnly cookie
Refresh token every 15 minutes
Logout clears cookies
Multi-Tenancy Security

Every query filters by business_id from JWT
Row-level security at database level
API keys for 3rd-party integrations (webhooks, calendar sync)
Public Endpoints

No auth required for /api/public/:slug/*
Rate limiting on booking submissions
CSRF protection
Features by Subscription Tier
Free Tier
Up to 10 bookings/month
Basic service management
Email notifications only
Limited customization
Pro Tier ($29/month)
Unlimited bookings
Team management
SMS/push notifications
Custom booking form
Google Calendar sync
Email templates
Enterprise Tier (custom pricing)
Everything in Pro
Zapier/webhook integrations
Multi-location support
Advanced analytics
Priority support
Custom branding
Integrations
Stripe - Payment processing
Twilio - SMS notifications
SendGrid/Mailgun - Email
Google Calendar - Calendar sync
Zapier - Workflow automation
Google Maps - Location display
Data Models (Detailed)
Booking Statuses
pending → confirmed → completed / cancelled / no-show
User Roles
owner - Full business access
admin - All features except billing
staff - Can only view assigned services & bookings
viewer - Read-only access
Notification Types
New booking confirmation (customer + business)
Reminder (24h before)
Cancellation notice
Review request (after completion)
Performance Considerations
Pagination on booking lists (50 per page)
Caching availability for 30 minutes
Debounce search queries
Lazy load customer history
CDN for static assets (logos, photos)
Testing Strategy
Unit tests for auth, booking logic
Integration tests for API endpoints
E2E tests for booking flow
Load testing for multi-tenant queries
This spec provides everything needed to build a production-ready multi-tenancy SaaS booking platform. Use it as a guide for your implementation!